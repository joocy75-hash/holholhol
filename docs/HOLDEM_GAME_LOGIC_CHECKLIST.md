# 텍사스 홀덤 게임 로직 검증 체크리스트 (최종본)

> 전문적인 수준의 텍사스 홀덤 게임을 개발하거나 검토하기 위한 종합 체크리스트입니다.
> 기본 규칙을 넘어서 복잡한 베팅 계산, 상태 관리, UI/UX, 그리고 치명적인 버그를 유발하는 엣지 케이스들을 철저히 검증합니다.
> 
> **프로젝트 현황**: 이 체크리스트는 현재 프로젝트의 구현 상태를 반영하여 작성되었습니다.

---

## 목차

1. [1단계: 테이블 및 게임 설정](#1단계-테이블-및-게임-설정)
2. [2단계: 베팅 메커니즘](#2단계-베팅-메커니즘)
3. [3단계: 핸드 평가 및 쇼다운](#3단계-핸드-평가-및-쇼다운)
4. [4단계: 게임 상태 및 무결성](#4단계-게임-상태-및-무결성)
5. [5단계: 클라이언트 UI/UX](#5단계-클라이언트-uiux)
6. [6단계: 개발자 체크리스트](#6단계-개발자-체크리스트)
7. [7단계: 보안 및 부정행위 방지](#7단계-보안-및-부정행위-방지)
8. [8단계: 성능 및 확장성](#8단계-성능-및-확장성)
9. [부록: 코드 매핑](#부록-코드-매핑)

---

## 1단계: 테이블 및 게임 설정

### 1.1 좌석 관리 및 버튼 로직

#### 좌석 배치 (9인 테이블)
- [x] 9개 좌석 지원 (0-8번)
- [x] 시계방향 좌석 순서 정의: `0 → 1 → 3 → 5 → 7 → 8 → 6 → 4 → 2`
- [x] 플레이어 시점 기준 좌석 회전 (내 좌석이 항상 하단 중앙)
- [ ] 좌석 예약 기능 (선택사항)

#### 데드 버튼 vs 전진 버튼
- [ ] 플레이어(특히 스몰 블라인드나 빅 블라인드)가 탈락했을 때 어떤 규칙을 사용할지 결정
- [ ] **표준**: 데드 버튼 (버튼이 제자리에 있거나 빈 좌석으로 이동하여, 다음 플레이어들이 올바르게 블라인드를 포스팅)
- [x] 딜러 버튼 위치 추적 (`dealer_seat`)

#### 헤즈업 특별 규칙
- [ ] 게임이 2인(헤즈업)이 되면, 딜러가 스몰 블라인드
- [ ] 딜러는 프리플랍에서 먼저 행동하지만, 포스트플랍에서는 마지막에 행동
- [ ] 이는 3명 이상일 때의 순서와 반대임을 확인
- [ ] 헤즈업 ↔ 멀티플레이어 전환 시 블라인드 위치 자동 조정

#### 늦은 참가자
- [ ] 새 플레이어가 버튼과 스몰 블라인드 사이에 참가하여 "버튼 구매"를 할 수 없도록 처리
- [ ] 일반적으로 빅 블라인드가 지나갈 때까지 기다리거나, "데드" 스몰 블라인드를 포스팅하여 즉시 참가
- [x] 바이인 모달을 통한 참가 (`BuyInModal`)
- [x] 최소/최대 바이인 금액 검증

#### 싯 아웃 (Sit Out)
- [x] 플레이어 상태: `active`, `folded`, `all_in`, `sitting_out`
- [x] `sit_out()` / `sit_in()` 메서드 구현
- [ ] **Sit Out Next Hand**: 이번 판은 치고 다음 판부터 자리비움
- [ ] **Sit Out Next BB**: 빅 블라인드 직전에 자리비움 (블라인드 비용 방어)
- [ ] 자리비움 상태에서 일정 시간 후 자동 퇴장

### 1.2 덱 및 셔플

#### RNG 무결성
- [ ] 셔플이 표준 수학 라이브러리 랜덤이 아닌 **암호학적으로 안전한 의사 난수 생성기(CSPRNG)** 사용 확인
- [x] PokerKit 라이브러리 사용 (내부 셔플 알고리즘)
- [ ] Python `secrets` 모듈 또는 `os.urandom()` 사용 검토

#### 증명 가능한 공정성 (선택사항)
- [ ] 암호화폐/Web3용: 서버 시드(해시됨), 클라이언트 시드, 논스 구현으로 덱 순서 변경 불가 증명
- [ ] 핸드 히스토리 해시 체인

### 1.3 게임 페이즈 관리

#### 페이즈 정의
- [x] `WAITING` - 대기 중
- [x] `PREFLOP` - 프리플랍 (홀 카드 배분 후)
- [x] `FLOP` - 플랍 (커뮤니티 카드 3장)
- [x] `TURN` - 턴 (커뮤니티 카드 4장)
- [x] `RIVER` - 리버 (커뮤니티 카드 5장)
- [x] `SHOWDOWN` - 쇼다운 (승자 결정)

---

## 2단계: 베팅 메커니즘

### 2.1 액션 검증 (서버 측)

#### 턴 검증
- [x] 서버가 자신의 턴이 아닌 플레이어의 액션 요청을 거부 (`NOT_YOUR_TURN` 에러)
- [x] 테이블별 Lock으로 동시 액션 처리 방지 (`_table_locks`)
- [x] 멱등성 체크 (Redis 기반 `request_id` 중복 방지)

#### 유효한 액션만 허용
- [x] 베팅에 직면한 플레이어는 "체크" 불가
- [x] 이미 올인한 플레이어는 "레이즈" 불가
- [x] `get_available_actions()` 메서드로 허용 액션 계산
- [x] 프론트엔드에서 `allowedActions` 기반 버튼 활성화/비활성화

#### 베팅 금액
- [x] **최소 베팅**: 빅 블라인드(BB)와 동일
- [x] **최소 레이즈**: 이전 베팅이 아닌, **이전 레이즈 증가분** 이상
  - 예시: A가 10 베팅 → B가 30으로 레이즈 (증가분 20) → C는 최소 50으로 레이즈 (30 + 20)
- [x] `minAmount`, `maxAmount` 프론트엔드 전달

### 2.2 "언더 레이즈" 규칙 (올인 엣지 케이스)

#### 베팅 재개
- [ ] 플레이어가 최소 레이즈 금액보다 적은 금액으로 올인하면, 이미 행동한 플레이어들에게 베팅이 재개되지 않음
- [ ] **시나리오**: A가 100 베팅 → B가 110으로 올인 → A는 콜(10 추가) 또는 폴드만 가능 (B의 레이즈가 "풀 레이즈"가 아니므로 리레이즈 불가)
- [ ] 언더 레이즈 시 레이즈 버튼 비활성화 로직

### 2.3 사이드 팟 계산

#### 반복적 팟 생성
- [x] 여러 플레이어가 다른 스택 크기로 올인하면, 메인 팟과 필요한 사이드 팟 생성
- [x] `sidePots` 상태 관리 (프론트엔드)
- [x] 사이드 팟 UI 표시 (`SidePotsDisplay` 컴포넌트)

#### 스택 매칭
- [x] 메인 팟은 가장 작은 올인 스택과 동일한 각 플레이어의 칩만 포함
- [x] PokerKit 내부 사이드 팟 계산 로직 활용

#### 환불
- [ ] 플레이어가 베팅/레이즈하고 다른 모든 플레이어가 폴드하거나 더 적은 금액으로 올인하면, 콜되지 않은 베팅 부분은 즉시 해당 플레이어에게 반환
- [ ] 환불 애니메이션 (칩이 플레이어에게 돌아가는 효과)

### 2.4 블라인드 포스팅

#### 기본 블라인드
- [x] 스몰 블라인드 / 빅 블라인드 자동 포스팅
- [x] 블라인드 위치 계산 (딜러 기준 시계방향)
- [x] 블라인드 금액 설정 (`small_blind`, `big_blind`)

#### 미스드 블라인드
- [ ] 자리비움 후 복귀 시 미스드 블라인드 처리
- [ ] **Wait for BB**: 빅 블라인드 차례까지 대기
- [ ] **Post Dead Blind**: 즉시 블라인드 지불 후 참가

---

## 3단계: 핸드 평가 및 쇼다운

### 3.1 핸드 랭킹 알고리즘

#### 7장 중 최고의 5장
- [x] 평가기가 7장의 카드(홀 카드 2장 + 커뮤니티 5장)의 모든 조합을 확인하여 절대적으로 최고의 5장 핸드를 찾음
- [x] PokerKit 핸드 평가기 사용
- [x] 프론트엔드 핸드 분석 (`analyzeHand` in `handEvaluator.ts`)

#### 핸드 랭킹 순서 (높은 순)
- [x] 로열 플러시 (Royal Flush)
- [x] 스트레이트 플러시 (Straight Flush)
- [x] 포카드 (Four of a Kind)
- [x] 풀하우스 (Full House)
- [x] 플러시 (Flush)
- [x] 스트레이트 (Straight)
- [x] 트리플 (Three of a Kind)
- [x] 투페어 (Two Pair)
- [x] 원페어 (One Pair)
- [x] 하이카드 (High Card)

#### 키커 문제
- [x] 동점을 깨기 위해 "키커"(사이드 카드)가 올바르게 사용되는지 확인
- [ ] **엣지 케이스**: 보드가 A-A-K-K-J이고 플레이어 1이 Q-2, 플레이어 2가 10-9를 가지면 → **타이(스플릿 팟)**
  - 둘 다 보드를 플레이 (보드의 J가 5번째 최고 카드이므로 플레이어 1의 퀸은 플레이되지 않음)

### 3.2 스플릿 팟 홀수 칩

#### 정수 연산
- [x] 칩에 부동소수점 연산을 **절대 사용하지 않음** - 반올림 오류 방지를 위해 정수 사용
- [x] 모든 금액은 정수 타입 (`int`)

#### 홀수 칩 분배
- [ ] 팟이 완벽하게 균등하게 나눠지지 않으면 (예: 25를 2명이 나눔):
  - 홀수 칩은 **버튼 왼쪽에 가장 가까운 플레이어**(가장 불리한 포지션)에게 배분
  - 하이 카드나 랜덤 플레이어에게 가지 않음

### 3.3 쇼다운 로직

#### 카드 공개 순서
- [x] 마지막 베팅/레이즈한 플레이어부터 공개
- [x] 쇼다운 카드 상태 관리 (`showdownCards`)
- [x] 카드 공개 애니메이션

#### 오토 머크 (Auto Muck)
- [ ] **기능 (Toggle)**: 쇼다운 시 내가 졌을 때, 카드를 상대에게 보여주지 않고 덮어버림 (전략 노출 방지)
- [ ] 승자는 반드시 카드 공개

#### 승자 하이라이트
- [x] 승자 포지션 표시 (`winnerPositions`)
- [x] 승리 금액 표시 (`winnerAmounts`)
- [x] 베스트 5장 카드 하이라이트 (`winnerBestCards`)
- [x] 승리 핸드 랭크 표시 (`allHandRanks`)

---

## 4단계: 게임 상태 및 무결성

### 4.1 연결 끊김 처리

#### 액션 타이머
- [x] 서버가 하드 타임아웃을 강제 (기본 30초)
- [x] 타임아웃 태스크 관리 (`_timeout_tasks`)
- [x] 프론트엔드 타이머 표시 (`TurnTimer` 컴포넌트)

#### 기본 액션
- [x] 플레이어가 타임아웃되면:
  - 베팅에 직면한 경우: **자동 폴드**
  - 체크가 무료인 경우: **자동 체크** (구현 확인 필요)
- [x] ⚠️ **경고**: 연결 끊김에 "자동 올인"을 **절대 구현하지 않음** (플레이어가 무료로 쇼다운을 보기 위해 악용 가능)

#### 타임 뱅크
- [x] 타임 뱅크 기능 구현 (`TIME_BANK_REQUEST`)
- [x] 기본 3회, 회당 30초 추가
- [x] 핸드 시작 시 타임 뱅크 리셋 (`reset_time_banks()`)
- [x] 타임 뱅크 버튼 UI (`TimeBankButton`)

### 4.2 레이크 로직

#### 노 플랍, 노 드롭
- [ ] 레이크는 표준적으로 핸드가 플랍에 도달했을 때만 징수
- [x] `_saw_flop` 플래그로 플랍 도달 여부 추적

#### 캡 적용
- [ ] 팟이 아무리 커져도 레이크는 특정 최대값으로 제한

#### 정밀도
- [ ] 하우스가 총액에서 몫을 가져가도록 팟 분배 전에 레이크 계산

### 4.3 게임 상태 비동기화

#### 재연결
- [x] 플레이어가 연결이 끊겼다가 재연결하면, 클라이언트가 전체 현재 상태(팟 크기, 커뮤니티 카드, 현재 행동자)를 다운로드하고 원활하게 재개
- [x] `TABLE_SNAPSHOT` 이벤트로 전체 상태 전송
- [x] WebSocket 재연결 로직 (`useTableWebSocket`)

#### 애니메이션 지연
- [x] 클라이언트가 현재 스트리트의 카드 딜 애니메이션을 완료하기 전에 서버가 다음 스트리트의 액션을 수락하지 않도록 처리
- [x] 딜링 애니메이션 대기 (`dealing_delay` 계산)
- [x] 페이즈 전환 딜레이 (`phase_transition_delay_seconds`)

### 4.4 핸드 히스토리

#### 액션 기록
- [x] 핸드별 액션 기록 (`_hand_actions`)
- [x] 핸드 시작 스택 기록 (`_hand_starting_stacks`)
- [x] 핸드 시작 시간 기록 (`_hand_start_time`)

#### 리플레이 기능
- [ ] 핸드 히스토리 조회 API
- [ ] 핸드 리플레이 UI

---

## 5단계: 클라이언트 UI/UX

> 플레이어의 UI는 **현재 게임 상태(Game State)**와 **플레이어의 상황(Context)**에 따라 동적으로 변해야 합니다.

### 5.1 메인 액션 버튼 (Main Action Buttons)

플레이어의 차례(Turn)가 되었을 때만 활성화되며, 상황에 따라 라벨과 기능이 바뀌어야 합니다.
(보통 화면 하단 중앙 또는 우측에 위치)

#### A. 폴드 (Fold)
- [x] **기능**: 현재 핸드를 포기하고 카드를 덮음
- [x] **조건**: 언제나 활성화 (단, 체크가 가능한 상황에서는 "체크"를 유도하는 것이 좋은 UX)
- [x] 폴드 버튼 이미지 (`btn_fold.png`)

#### B. 체크 / 콜 (Check / Call) - 상태 의존적

**체크 (Check):**
- [x] 앞선 플레이어들의 배팅이 없을 때 (Bet amount = 0)
- [x] 빅 블라인드(BB) 위치에서 프리플랍에 레이즈가 없을 때
- [x] 체크 버튼 이미지 (`btn_check.png`)

**콜 (Call):**
- [x] 누군가 배팅을 하여, 게임을 계속하기 위해 지불해야 할 금액이 있을 때
- [x] 버튼에는 **"Call [금액]"** 형태로 정확한 액수를 표시 (예: `콜(100)`)
- [x] 콜 버튼 이미지 (`btn_call.png`)

#### C. 벳 / 레이즈 / 올인 (Bet / Raise / All-In) - 상태 의존적

- [x] **벳 (Bet)**: 앞선 배팅이 없을 때 칩을 거는 행위
- [x] **레이즈 (Raise)**: 앞선 배팅이 있을 때 금액을 더 키우는 행위
- [x] **올인 (All-In)**:
  - 보유 칩이 현재 최소 벳/콜 금액보다 적을 때
  - 또는 플레이어가 보유 칩 전액을 배팅하려 할 때
- [x] 레이즈/올인 버튼 이미지 (`btn_raise.png`, `btn_allin.png`)

### 5.2 배팅 금액 조절 UI (Bet Sizing Controls)

플레이어가 '벳'이나 '레이즈'를 선택했을 때, 구체적인 금액을 설정하는 도구입니다.
모바일 환경을 고려하여 단축 버튼이 매우 중요합니다.

#### A. 배팅 슬라이더 (Bet Slider)
- [x] **기능**: 최소 레이즈 금액부터 본인의 올인 금액까지 드래그하여 조절
- [x] **필수 로직**: 슬라이더의 최소값은 **[이전 레이즈 금액 + 최소 레이즈 단위]**여야 함 (단순 콜 금액에서 시작하면 안 됨)
- [x] `data-testid="raise-slider"` 구현

#### B. 배팅 텍스트 입력기 (Numpad Input)
- [x] **기능**: 슬라이더로 조절하기 힘든 정밀한 숫자를 직접 입력
- [x] `data-testid="raise-input"` 구현

#### C. 팟(Pot) 비율 단축 버튼 (Shortcut Buttons)

빠른 게임 진행을 위해 계산된 금액을 즉시 입력해주는 버튼들:

| 버튼 | 설명 | 구현 상태 |
|------|------|----------|
| **Min (최소)** | 규정상 가능한 최소 배팅/레이즈 금액 | ✅ |
| **1/2 Pot** | 현재 팟 사이즈의 50% | ✅ (1/2 버튼) |
| **3/4 Pot** | 현재 팟 사이즈의 75% | ✅ |
| **Pot** | 현재 팟 사이즈의 100% | ⚠️ (MAX로 대체) |
| **Max / All-In** | 보유 칩 전액 | ✅ |

> ⚠️ **개발 팁**: 레이즈 상황에서의 'Pot' 계산은 `[콜 비용 + (현재 팟 + 콜 비용)]` 공식이 적용되어야 정확함

### 5.3 사전 예약 액션 버튼 (Pre-Action Buttons)

내 차례가 오기 전에 미리 의사결정을 내려 게임 속도를 높이는 기능입니다. (체크박스 형태)

| 버튼 | 설명 | 구현 상태 |
|------|------|----------|
| **Check / Fold** | 무료로 체크할 수 있으면 체크하고, 누가 돈을 걸면 자동으로 폴드 | ❌ |
| **Check** | 체크가 가능할 때만 체크 (누가 돈을 걸면 체크박스 해제되고 플레이어에게 선택권이 넘어옴) | ❌ |
| **Call Any** | 상대가 얼마를 걸든 상관없이 내 턴이 오면 즉시 콜 (⚠️ 매우 위험하므로 경고 필요) | ❌ |
| **Fold to Any Bet** | 누가 1칩이라도 걸면 즉시 폴드 | ❌ |

### 5.4 게임 설정 및 상태 버튼 (System & Toggle Buttons)

게임 흐름에 직접 관여하지 않지만 편의를 위해 필요한 버튼들입니다.

#### A. 오토 머크 (Auto Muck)
- [ ] **기능 (Toggle)**: 쇼다운(Showdown) 시 내가 졌을 때, 카드를 상대에게 보여주지 않고 덮어버림 (전략 노출 방지)

#### B. 싯 아웃 (Sit Out)
- [ ] **Sit Out Next Hand**: 이번 판은 치고 다음 판부터 자리비움 상태로 전환
- [ ] **Sit Out Next BB**: 내 포지션이 빅 블라인드가 되기 직전에 자리비움 (블라인드 비용 방어)

#### C. 블라인드 포스팅 (Post Blinds)
- [ ] **Wait for BB**: 테이블에 난입했을 때 바로 참여하지 않고, 빅 블라인드 차례가 올 때까지 관전하며 대기
- [ ] **Post Dead Blind**: 기다리지 않고 즉시 블라인드를 지불하고 게임에 참여 (버튼)

#### D. 바이인 / 리바이 (Buy-in / Add-on)
- [x] 칩을 다 잃었거나 추가 충전이 필요할 때 지갑에서 테이블로 칩을 가져오는 버튼
- [x] `BuyInModal` 컴포넌트
- [x] `RebuyModal` 컴포넌트

### 5.5 카드 표시

#### 홀 카드
- [x] 내 카드는 앞면 표시 (자동 오픈 10초 후)
- [x] 다른 플레이어 카드는 뒷면 표시
- [x] 카드 클릭으로 수동 오픈 (`onRevealCards`)
- [x] 플립 애니메이션 (`FlippableCard`)

#### 커뮤니티 카드
- [x] 플랍: 3장 동시 공개
- [x] 턴: 1장 추가 공개
- [x] 리버: 1장 추가 공개
- [x] 공개 애니메이션 (`revealedCommunityCount`)

### 5.6 족보 가이드

- [x] 실시간 족보 계산 (`myHandAnalysis`)
- [x] 현재 핸드 랭크 표시
- [x] 드로우 가능성 표시 (플러시 드로우, 스트레이트 드로우)
- [x] `HandRankingGuide` 컴포넌트

---

## 6단계: 개발자 체크리스트

### 6.1 버튼 상태 로직

#### 언더 레이즈(Under-Raise) 대응
- [ ] 상대가 올인을 했는데, 그 금액이 '최소 레이즈' 조건에 미달하는 경우(Short stack all-in)
- [ ] 플레이어에게 [레이즈] 버튼을 **비활성화**하고 **[콜]**과 **[폴드]**만 보여줘야 하는 경우 처리 (룰에 따라 다름)

#### 동시성 처리
- [x] 플레이어가 [Call] 버튼을 누르는 찰나에 앞 사람이 먼저 [Raise]를 했다면?
  - 서버는 요청을 거절 (`NOT_YOUR_TURN`)
  - 클라이언트는 버튼 UI를 갱신 (Call 금액 변경)
- [x] 테이블별 Lock (`_table_locks`)

#### 애니메이션 동기화
- [x] 카드 딜링이나 칩 이동 애니메이션이 끝날 때까지 버튼을 **비활성화(Grayed out)** 처리하여 실수 방지
- [x] `dealingComplete` 상태로 딜링 완료 여부 추적
- [x] `isMyTurn`은 `dealingComplete && currentTurnPosition === myPosition`

### 6.2 서버-클라이언트 동기화

#### 상태 검증
- [x] 모든 액션은 서버에서 검증 후 브로드캐스트
- [x] 클라이언트는 서버 응답을 기다린 후 UI 업데이트
- [x] `ACTION_RESULT` 이벤트로 결과 전달

#### 낙관적 업데이트 (Optimistic Update)
- [ ] 빠른 UX를 위해 클라이언트에서 먼저 UI 업데이트 후 서버 응답으로 확정/롤백
- [x] 현재는 서버 응답 후 업데이트 방식

#### WebSocket 이벤트
- [x] `TABLE_SNAPSHOT` - 전체 테이블 상태
- [x] `TABLE_STATE_UPDATE` - 상태 변경
- [x] `ACTION_RESULT` - 액션 결과
- [x] `TURN_PROMPT` - 턴 알림
- [x] `HAND_RESULT` - 핸드 결과
- [x] `COMMUNITY_CARDS` - 커뮤니티 카드 공개

### 6.3 테스트 시나리오

#### 필수 테스트 케이스
- [x] 2인 헤즈업 게임 (블라인드/액션 순서 특수 규칙) - E2E 테스트 존재
- [x] 3인 이상 멀티플레이어 게임 - E2E 테스트 존재
- [x] 올인 상황 (사이드 팟 생성) - E2E 테스트 존재
- [ ] 언더 레이즈 상황
- [x] 타임아웃 자동 폴드/체크 - E2E 테스트 존재
- [x] 연결 끊김 후 재연결 - E2E 테스트 존재
- [x] 스플릿 팟 (동점 상황) - 백엔드 테스트 존재
- [ ] 홀수 칩 분배

### 6.4 봇 로직

#### 봇 플레이어
- [x] 봇 생성 (`add_bot_player`)
- [x] 봇 식별 (`is_bot_player`)
- [x] 봇 전략 (`_decide_bot_action`)

#### 봇 결정 로직
- [x] 핸드 강도 평가 (`evaluate_hand_for_bot`)
- [x] 팟 오즈 고려
- [x] 드로우 가능성 고려
- [x] 무작위성 추가 (예측 불가능하게)
- [x] 인간처럼 생각하는 딜레이 (삼각 분포)

---

## 7단계: 보안 및 부정행위 방지

### 7.1 서버 권한 (Server Authority)

#### 모든 게임 로직은 서버에서 처리
- [x] 클라이언트는 액션 요청만 전송
- [x] 서버가 유효성 검증 후 결과 브로드캐스트
- [x] 클라이언트는 서버 상태를 신뢰

#### 카드 정보 보호
- [x] 다른 플레이어의 홀 카드는 쇼다운 전까지 전송하지 않음
- [x] `HOLE_CARDS` 이벤트는 해당 플레이어에게만 전송
- [ ] 패킷 스니핑으로 다른 플레이어 카드 확인 불가 검증

### 7.2 입력 검증

#### Pydantic 스키마 검증
- [x] `ActionRequestPayload` 스키마로 요청 검증
- [x] 잘못된 요청 형식 거부 (`INVALID_PAYLOAD`)

#### 금액 검증
- [x] 최소/최대 베팅 금액 검증
- [x] 스택 초과 베팅 방지
- [x] 음수 금액 방지

### 7.3 레이트 리미팅

#### 액션 레이트 리미트
- [x] 미들웨어 레벨 레이트 리미팅 (`rate_limit.py`)
- [ ] 플레이어별 액션 빈도 제한
- [ ] 의심스러운 패턴 감지

### 7.4 로깅 및 감사

#### 구조화된 로깅
- [x] 모든 액션 로깅 (`action_received`, `action_processed`)
- [x] 에러 로깅 (`action_error`)
- [x] 처리 시간 측정 (`processing_time_ms`)
- [x] 트레이스 ID 추적 (`trace_id`)

#### 감사 로그
- [ ] 의심스러운 활동 기록
- [ ] 관리자 대시보드 연동

---

## 8단계: 성능 및 확장성

### 8.1 메모리 관리

#### 테이블 관리
- [x] 메모리 기반 테이블 관리 (`GameManager`)
- [x] 테이블 생성/삭제 (`create_table`, `remove_table`)
- [x] 정리 콜백 (`register_cleanup_callback`)

#### 메모리 정리
- [ ] 비활성 테이블 자동 정리
- [ ] 메모리 사용량 모니터링

### 8.2 동시성

#### 비동기 처리
- [x] `asyncio` 기반 비동기 처리
- [x] 테이블별 Lock으로 레이스 컨디션 방지
- [x] 봇 루프 안전 종료 (MAX_ITERATIONS)

#### WebSocket 관리
- [x] 연결 관리자 (`ConnectionManager`)
- [x] 룸별 브로드캐스트
- [x] 개인화된 상태 전송 (`_broadcast_personalized_states`)

### 8.3 확장성

#### 수평 확장
- [ ] Redis Pub/Sub을 통한 다중 서버 지원
- [ ] 세션 스티키니스 또는 상태 공유

#### 데이터베이스
- [ ] 핸드 히스토리 영구 저장
- [ ] 플레이어 통계 저장

---

## 부록: 코드 매핑

### 백엔드 주요 파일

| 파일 | 설명 |
|------|------|
| `backend/app/game/poker_table.py` | 포커 테이블 핵심 로직 |
| `backend/app/game/manager.py` | 테이블 관리자 (싱글톤) |
| `backend/app/ws/handlers/action.py` | 액션 이벤트 핸들러 |
| `backend/app/game/hand_evaluator.py` | 핸드 평가기 |
| `backend/app/game/types.py` | 타입 정의 |

### 프론트엔드 주요 파일

| 파일 | 설명 |
|------|------|
| `frontend/src/app/table/[id]/page.tsx` | 테이블 페이지 |
| `frontend/src/components/table/ActionPanel.tsx` | 액션 버튼 패널 |
| `frontend/src/components/table/SeatsRenderer.tsx` | 좌석 렌더링 |
| `frontend/src/components/table/PlayerSeat.tsx` | 플레이어 좌석 |
| `frontend/src/hooks/table/useGameState.ts` | 게임 상태 훅 |
| `frontend/src/hooks/table/useTableWebSocket.ts` | WebSocket 훅 |
| `frontend/src/hooks/table/useTableActions.ts` | 액션 훅 |

### 좌석 위치 설정 (SEAT_POSITIONS)

```typescript
// frontend/src/components/table/PlayerSeat.tsx
export const SEAT_POSITIONS = [
  { top: '90%', left: '50%' },   // 0 - bottom center (ME/Player)
  { top: '70%', left: '9%' },    // 1 - lower left
  { top: '70%', left: '91%' },   // 2 - lower right
  { top: '52%', left: '10%' },   // 3 - mid left
  { top: '52%', left: '90%' },   // 4 - mid right
  { top: '35%', left: '18%' },   // 5 - upper left
  { top: '35%', left: '82%' },   // 6 - upper right
  { top: '21%', left: '35%' },   // 7 - top left
  { top: '21%', left: '65%' },   // 8 - top right
];
```

### 시계방향 좌석 순서

```python
# backend/app/game/poker_table.py
CLOCKWISE_SEAT_ORDER = [0, 1, 3, 5, 7, 8, 6, 4, 2]
```

---

## 구현 우선순위 (미구현 항목)

### 🔴 높음 (핵심 게임 로직)

1. **언더 레이즈 규칙** - 올인 엣지 케이스 처리
2. **헤즈업 특별 규칙** - 2인 게임 시 블라인드/액션 순서
3. **홀수 칩 분배** - 스플릿 팟 시 정확한 분배
4. **환불 로직** - 콜되지 않은 베팅 반환

### 🟡 중간 (UX 개선)

1. **사전 예약 액션 버튼** - Check/Fold, Call Any 등
2. **오토 머크** - 패배 시 카드 숨기기
3. **싯 아웃 UI** - Sit Out Next Hand, Sit Out Next BB
4. **미스드 블라인드 처리** - Wait for BB, Post Dead Blind

### 🟢 낮음 (부가 기능)

1. **증명 가능한 공정성** - 암호화 기반 덱 검증
2. **레이크 로직** - 수수료 징수
3. **핸드 히스토리 UI** - 리플레이 기능
4. **낙관적 업데이트** - 빠른 UX

---

## 참고 자료

이 체크리스트는 실제 리얼 머니 포커(PokerStars, GGNetwork 등)에서 사용하는 표준 UX 기준을 참고하여 작성되었습니다.

### 참고 문서
- [PokerKit Documentation](https://github.com/uoftcprg/pokerkit)
- [Texas Hold'em Rules - PokerStars](https://www.pokerstars.com/poker/games/texas-holdem/)
- [Robert's Rules of Poker](https://www.homepokertourney.com/roberts-rules-of-poker.htm)

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2026-01-15 | 1.0 | 초기 문서 작성 |
| 2026-01-15 | 2.0 | 최종본 - 프로젝트 구현 상태 반영, 코드 매핑 추가, 우선순위 정리 |
